<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Image Prep Tool</title>
  <style>
    body { font-family: sans-serif; padding: 2rem; }
    input, button { margin: 1rem 0; display: block; }
    canvas, img { max-width: 100%; margin-top: 1rem; }
  </style>
</head>
<body>
  <h2>Auto Prep Image for OpenAI Editing</h2>
  <input type="file" id="imageInput" accept="image/*">
  <button onclick="processImage()">Remove Background & Make Square</button>
  <br>
  <canvas id="canvas" style="display:none;"></canvas>
  <img id="preview" alt="Preview will appear here">
  <br>
  <a id="downloadLink" download="transparent_square.png">Download Transparent PNG</a>

  <script>
    async function processImage() {
      const fileInput = document.getElementById('imageInput');
      const file = fileInput.files[0];
      if (!file) return alert('Please upload an image.');

      const formData = new FormData();
      formData.append("image_file", file);
      formData.append("size", "auto");

      const response = await fetch('https://api.remove.bg/v1.0/removebg', {
        method: 'POST',
        headers: {
          'X-Api-Key': "fZA2VT37MBjciGpSCeDkV1Nc"
        },
        body: formData
      });

      if (!response.ok) {
        const errorText = await response.text();
        console.error(errorText);
        return alert('Error removing background. Check console for details.');
      }

      const blob = await response.blob();
      const img = new Image();
      img.onload = () => {
        const canvas = document.getElementById('canvas');
        const size = Math.max(img.width, img.height);
        canvas.width = size;
        canvas.height = size;

        const ctx = canvas.getContext('2d');
        ctx.clearRect(0, 0, size, size);
        ctx.drawImage(img, (size - img.width) / 2, (size - img.height) / 2);

        const dataURL = canvas.toDataURL('image/png');
        document.getElementById('preview').src = dataURL;
        document.getElementById('downloadLink').href = dataURL;
      };
      img.src = URL.createObjectURL(blob);
    }
  </script>
</body>
</html>
